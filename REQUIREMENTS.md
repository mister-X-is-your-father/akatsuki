# A.K.A.T.S.U.K.I. システム要件定義書

**System:** A.K.A.T.S.U.K.I. (暁 / アカツキ)  
**Full:** Autonomous Knowledge Agent Team for Strategic Update & Knowledge Integration  
**直訳:** 戦略的更新と知識統合のための自律的ナレッジエージェントチーム

> **注意:** このドキュメントは、実装時の設計図（ブループリント）として機能するレベルで記述しています。

---

## 1. プロジェクト基本情報

### 1.1 目的
事業の立ち上げおよび運営業務の自律的遂行。

### 1.2 基本概念
階層型マルチエージェントシステムにより、以下の機能を自律的に実現する：
- 業務実行
- 品質管理
- 組織拡張
- ナレッジ蓄積

人間（User）は戦略的意思決定のみに注力する。

---

## 2. システムアーキテクチャ

### 2.1 技術スタック

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| **Orchestration** | **LangGraph** (Python) | 状態遷移図に基づくエージェント制御、循環ループ、条件分岐の実装 |
| **Foundation Model** | **Claude 4.5 Sonnet** (ベース、via Anthropic API) / **任意のAIモデル** (各種API経由) | 推論、計画、コード生成、レビュー。各エージェントごとにAIモデルを選択可能 |
| **Database & Interface** | **Obsidian** (Local Markdown Files) | データベースとして機能し、ユーザーインターフェースでもある |
| **Data Structure** | **YAML Frontmatter** | エージェント属性、リレーション、ルール属性の管理 |
| **Tools** | **Browser-use** | Web操作 |
| **Tools** | **Zapier** | アプリ連携 |
| **Tools** | **Local File System** | ファイル操作 |

### 2.2 ディレクトリ構造 (Database Schema)

システムは以下のディレクトリ構造を厳格に維持し、各フォルダを特定のデータベース領域として扱う。

```
/AI_Manager_Root
  ├── 00_Strategy_Input/       # [User I/O] 戦略指示書格納（Trigger）
  ├── 10_Decision_Board/       # [User I/O] 承認・決裁・相談案件の提示
  ├── 20_Approved_Outputs/     # [Storage] 承認済み成果物のアーカイブ
  ├── 30_Work_Space/           # [Runtime] 一時作業領域（自動削除対象の一時ファイルのみ）
  │   └── temp/                # 一時ファイル（ステート管理対象外の一時データ）
  ├── 80_Team_Profiles/        # [DB: HR] エージェント定義ファイル（YAML+MD）
  │   └── [agent_id].md        # エージェント定義（96_Agents/[agent_id]/profile.mdへの参照またはシンボリックリンク）
  ├── 90_Rules/                # [DB: Legal] 業務ルール・ガイドライン（階層管理）
  │   ├── 00_Global/           # 全社共通ルール（全エージェントに適用）
  │   ├── 10_Dept/             # 部門ルール（特定部門に適用）
  │   │   ├── [dept_id_1]/     # 部門ごとのルールディレクトリ
  │   │   └── [dept_id_2]/
  │   └── 20_Cross_Dept/       # 複数部門共通ルール
  ├── 95_Library/              # [DB: Knowledge] 共有ナレッジ・外部情報・学習履歴
  │   ├── 00_Global/           # 全社共有ナレッジ
  │   └── 10_Dept/             # 部門共有ナレッジ
  │       └── [dept_id]/
  ├── 96_Agents/               # [DB: Agent-Specific] エージェント個別領域（統合構成）
  │   └── [agent_id]/          # エージェントごとのディレクトリ（全データを統合）
  │       ├── profile.md       # エージェント定義（80_Team_Profiles/[agent_id].mdの実体または参照元）
  │       ├── work/            # 作業領域（30_Work_Spaceの代替、エージェント固有）
  │       │   ├── drafts/      # 作成中の成果物
  │       │   └── review_logs/ # 修正指示・レビュー記録
  │       ├── rules/           # 個人ルール（このエージェント専用）
  │       ├── library/         # 個人ナレッジ（このエージェントが収集した知識）
  │       ├── performance/     # パフォーマンス記録・評価履歴
  │       └── logs/            # エージェント固有のログ
  │           └── knowledge_access/  # ナレッジアクセスログ
  ├── 97_Communication/        # [DB: Collaboration] エージェント間コミュニケーション
  │   ├── Conversations/      # エージェント間の会話記録
  │   ├── Decisions/           # 意思決定の記録
  │   └── Dependencies/        # タスク間の依存関係マップ
  ├── 98_Metrics/              # [DB: Analytics] 組織運営メトリクス
  │   ├── Performance/         # パフォーマンス指標（組織全体・部門別集計）
  │   ├── Quality/             # 品質メトリクス
  │   ├── Risk/                # リスク評価記録
  │   └── Health/             # システム健全性チェック
  └── 99_Logs/                 # [System] システム全体の実行ログ・コスト管理ログ
      └── cost_tracking.log    # コスト追跡ログ（全エージェント統合）
```

#### ディレクトリの役割詳細

| ディレクトリ | 用途 | アクセス権限 | 備考 |
|------------|------|------------|------|
| `00_Strategy_Input/` | 戦略指示書の格納 | User → System | システムのトリガーとして機能 |
| `10_Decision_Board/` | 承認・決裁・相談案件の提示 | System → User | Userの意思決定を待つ領域 |
| `20_Approved_Outputs/` | 承認済み成果物のアーカイブ | System | 最終的な成果物を永続保存 |
| `30_Work_Space/temp/` | 一時作業領域 | System (Runtime) | 自動削除対象の一時ファイルのみ。ステート管理対象外 |
| `80_Team_Profiles/[agent_id].md` | エージェント定義ファイル | System | YAML+MD形式。96_Agents/[agent_id]/profile.mdへの参照またはシンボリックリンク |
| `90_Rules/00_Global/` | 全社共通ルール | System | 全エージェントに適用されるルール |
| `90_Rules/10_Dept/[dept_id]/` | 部門ルール | System | 特定部門に適用されるルール |
| `90_Rules/20_Cross_Dept/` | 複数部門共通ルール | System | 複数の部門に共通して適用されるルール |
| `95_Library/00_Global/` | 全社共有ナレッジ | System | 全エージェントが参照可能な知識 |
| `95_Library/10_Dept/[dept_id]/` | 部門共有ナレッジ | System | 特定部門内で共有される知識 |
| `96_Agents/[agent_id]/profile.md` | エージェント定義（実体） | System | エージェント定義の実体。80_Team_Profilesから参照 |
| `96_Agents/[agent_id]/work/drafts/` | 作成中の成果物 | System | エージェント固有の作業中のドラフト（30_Work_Spaceの代替） |
| `96_Agents/[agent_id]/work/review_logs/` | 修正指示・レビュー記録 | System | エージェント固有のレビュー履歴（30_Work_Spaceの代替） |
| `96_Agents/[agent_id]/rules/` | 個人ルール | System | 特定エージェント専用のルール |
| `96_Agents/[agent_id]/library/` | 個人ナレッジ | System | エージェントが個別に収集・蓄積した知識 |
| `96_Agents/[agent_id]/performance/` | パフォーマンス記録 | System | エージェントの評価履歴、改善提案 |
| `96_Agents/[agent_id]/logs/knowledge_access/` | ナレッジアクセスログ | System | エージェント固有のナレッジ参照記録 |
| `97_Communication/Conversations/` | エージェント間会話 | System | エージェント間のコミュニケーション記録 |
| `97_Communication/Decisions/` | 意思決定記録 | System | 重要な意思決定の記録と根拠 |
| `97_Communication/Dependencies/` | 依存関係マップ | System | タスク間の依存関係、クリティカルパス |
| `98_Metrics/Performance/` | パフォーマンス指標 | System | 組織全体・部門別の集計KPI（個別は96_Agents/[agent_id]/performance/） |
| `98_Metrics/Quality/` | 品質メトリクス | System | 品質スコア、レビュー通過率等 |
| `98_Metrics/Risk/` | リスク評価記録 | System | リスクの検出・評価・対応履歴 |
| `98_Metrics/Health/` | システム健全性 | System | システム全体の健康状態チェック結果 |
| `99_Logs/cost_tracking.log` | コスト追跡ログ | System | システム全体のコスト追跡（全エージェント統合） |

---

## 3. 組織設計とエージェント仕様

### 3.1 階層構造と役割 (Hierarchy)

| 階層 | 役職ID | 役割定義 | 権限・責任 |
| :--- | :--- | :--- | :--- |
| **L0** | **User** | 会長・オーナー | 戦略決定、最終成果物の承認、予算承認、増員（定員超）の許可 |
| **L1** | **General Commander** | 総司令官 | 全体戦略のタスク分解、L2の生成・管理、L2間の調整、Userへの報告 |
| **L2** | **Dept. Manager** | 部門責任者 | 専門領域の指揮、**成果物の承認（Gatekeeper）**、L3の生成・管理、**担当領域ルールの策定・更新** |
| **L3** | **Worker** | 実務担当者 | 実務実行（調査・制作）、**上位方針への批判的意見具申（Bottom-up Critique）** |

### 3.2 エージェントデータ構造 (YAML Schema)

`80_Team_Profiles/*.md` のヘッダー仕様。LangGraphはこの情報を読み取り、ノードを動的に生成する。

#### YAML Frontmatter スキーマ

```yaml
---
id: "agent_marketing_lead"      # 一意のID（必須）
type: "Manager"                 # Manager | Worker（必須）
name: "Marketing Director"      # 表示名（必須）
supervisor_id: "agent_commander" # 直属の上司ID（必須）
# --- 組織管理パラメータ ---
current_headcount: 2            # 現在の部下数（必須）
max_subordinates: 3             # 部下数の上限（コスト管理用）（必須）
can_hire: true                  # 部下作成権限の有無（必須）
# --- スキル・ナレッジ ---
tools:                          # 使用可能ツール（必須）
  - "file_read"
  - "file_write"
  - "agent_creation"
  - "browser_use"
subscription_rules:             # 遵守すべきルールID（必須、階層的）
  - "00_Global/rule_constitution"      # 全社ルール
  - "10_Dept/marketing/rule_branding"  # 部門ルール（部門ID/ルール名）
  - "20_Cross_Dept/rule_collaboration"  # 複数部門共通ルール
  # 個人ルールは自動的に 96_Agents/[agent_id]/Rules/ から読み込まれる
read_access_library:            # 参照すべきナレッジカテゴリ（任意）
  - "00_Global/Trends"          # 全社共有ナレッジ
  - "10_Dept/marketing/Best_Practices" # 部門共有ナレッジ
  # 個人ナレッジは自動的に 96_Agents/[agent_id]/Library/ から読み込まれる
# --- AIモデル設定 ---
foundation_model:                # 使用するAIモデル（必須）
  provider: "anthropic"         # APIプロバイダー（anthropic, openai, google, etc.）
  model: "claude-4-5-sonnet"    # モデル名（例: claude-4-5-sonnet, gpt-4, gemini-pro）
  api_key_env: "ANTHROPIC_API_KEY"  # 環境変数名（.envファイルから読み込み）
# --- 自己進化パラメータ ---
learned_lessons:                # タスク完了ごとに追記される学習履歴（任意）
  - "2025-01-01: Xの投稿は朝7時が最適である"
# --- パフォーマンス管理 ---
performance_metrics:            # パフォーマンス指標（自動更新）
  quality_score: 0.85           # 品質スコア（0-1）
  efficiency_score: 0.78        # 効率スコア（0-1）
  collaboration_score: 0.92     # 協調性スコア（0-1）
  last_evaluated: "2025-01-15"  # 最終評価日
workload_status: "normal"      # 負荷状態（normal, high, critical）
---
```

#### フィールド詳細

| フィールド | 型 | 必須 | 説明 |
|----------|-----|------|------|
| `id` | string | ✓ | エージェントの一意識別子。システム内で重複不可 |
| `type` | enum | ✓ | `Manager` または `Worker`。階層構造を決定 |
| `name` | string | ✓ | エージェントの表示名 |
| `supervisor_id` | string | ✓ | 直属の上司エージェントのID。Userの場合は空文字列 |
| `current_headcount` | integer | ✓ | 現在の直属部下の数 |
| `max_subordinates` | integer | ✓ | 部下数の上限。コスト管理とリソース制限に使用 |
| `can_hire` | boolean | ✓ | 部下を生成する権限の有無 |
| `tools` | array[string] | ✓ | エージェントが使用可能なツールのリスト |
| `subscription_rules` | array[string] | ✓ | 遵守すべきルールファイルのIDリスト |
| `read_access_library` | array[string] | 任意 | 参照可能なナレッジライブラリのカテゴリ |
| `foundation_model` | object | ✓ | エージェントが使用するAIモデルの設定（provider, model, api_key_env） |
| `learned_lessons` | array[string] | 任意 | タスク完了時に追記される学習履歴 |
| `performance_metrics` | object | 任意 | パフォーマンス指標（quality_score, efficiency_score, collaboration_score, last_evaluated） |
| `workload_status` | enum | 任意 | 負荷状態（normal, high, critical）。システムが自動更新 |

---

## 4. 業務プロセス仕様 (LangGraph Workflow)

システムは以下のステートマシンとして実装される。

### 4.1 計画と批判 (Planning & Critique Phase)

#### 4.1.1 プロセスフロー

1. **Instruction（指示）**
   - 上位階層（User or Commander）が指示を発行
   - 指示は `00_Strategy_Input/` にMarkdownファイルとして保存
   - システムは指示を解析し、担当Managerを特定

2. **Assignment（割り当て）**
   - 担当Managerへタスクを割り当て
   - タスク情報を `96_Agents/[agent_id]/work/drafts/` に記録

3. **Critique（批判的検証 - Bottom-up）**
   - 指示を受けたエージェントは即座に実行せず、以下を実施：
     - **ナレッジ参照（必須）:** 関連ナレッジを必ず検索・参照する
       - 自身のナレッジ（`learned_lessons`、`96_Agents/[agent_id]/Library/`）を参照
       - 共有ライブラリ（`95_Library/00_Global/`、`95_Library/10_Dept/[dept_id]/`）を検索
       - ナレッジ参照ログを記録（`96_Agents/[agent_id]/logs/knowledge_access/[date].log`）
     - 関連ルールを階層的に確認：
       - 全社ルール（`90_Rules/00_Global/`）
       - 部門ルール（`90_Rules/10_Dept/[dept_id]/`）
       - 複数部門共通ルール（`90_Rules/20_Cross_Dept/`）
       - 個人ルール（`96_Agents/[agent_id]/Rules/`）
   - **指示の妥当性を検証（必須）**
   - **Yesマン対策:** 「はい」と即答することを禁止。必ず検証結果を報告
   - **ナレッジ未参照の検出:** 関連ナレッジが存在したにも関わらず参照されなかった場合、警告を発出
   - 検証結果は以下のいずれか：
     - **承認:** 問題なしと判断した場合でも、判断根拠を明確に記述
     - **条件付き承認:** 条件を満たせば実行可能。条件を明記
     - **修正提案:** 問題がある場合、具体的な修正案を提示
     - **代替案:** より良い代替案がある場合、代替案を提示
     - **拒否:** 実行不可能な場合、理由と代替案を提示（代替案なしの拒否は不可）
   - 矛盾やリスクがある場合：
     - 代替案を必ず提示（代替案なしの拒否は不可）
     - 上司と合意形成を行う（`10_Decision_Board/` に相談チケットを発行）
   - 検証結果は `96_Agents/[agent_id]/work/review_logs/critique/` に記録

#### 4.1.2 実装要件

- Critique機能は必須機能として実装
- エージェントは常に「指示の妥当性」を検証するプロンプトを持つ
- 検証結果は `96_Agents/[agent_id]/work/review_logs/` に記録

### 4.2 実行と承認 (Execution & Review Phase)

#### 4.2.1 プロセスフロー

1. **Drafting（ドラフト作成）**
   - Workerがツールを使用してドラフトを作成
   - ドラフトは `96_Agents/[agent_id]/work/drafts/` に保存
   - ドラフトにはメタデータ（作成者、作成日時、関連タスクID等）を付与

2. **Review（Manager審査）**
   - 直属のManagerが成果物を審査
   - **審査基準:**
     - 全社ルール（`90_Rules/00_Global/`）との整合性
     - 部門ルール（`90_Rules/10_Dept/[dept_id]/`）との整合性
     - 複数部門共通ルール（`90_Rules/20_Cross_Dept/`）との整合性
     - 個人ルール（`96_Agents/[agent_id]/Rules/`）との整合性
     - 指示内容との整合性
     - 品質基準（明確性、完全性、実現可能性）
   - **ナレッジ参照チェック（必須）:**
     - Managerは指摘内容が既存ナレッジに含まれていないか検証
     - 既存ナレッジに含まれていた場合、**即座にNG**とする
     - NG理由: 「既存ナレッジ（`[ナレッジファイルパス]`）を参照すべきだったが参照されていない」
     - このNGは重大な問題として扱い、ナレッジ活用システムの改善を促す

3. **Review結果の処理**

   **NG（差し戻し）の場合:**
   - 具体的な修正理由を添えて差し戻す
   - 修正理由は `96_Agents/[agent_id]/work/review_logs/` に記録
   - **ルール振り分け（Rule Routing）:** Managerは指摘内容を分析し、以下のいずれかに分類してルール化する：
     - **全社ルール** (`90_Rules/00_Global/`): 全エージェントに適用すべき指摘
     - **部門ルール** (`90_Rules/10_Dept/[dept_id]/`): 特定部門に適用すべき指摘
     - **複数部門共通ルール** (`90_Rules/20_Cross_Dept/`): 複数部門に共通して適用すべき指摘
     - **個人ルール** (`96_Agents/[agent_id]/Rules/`): 特定エージェントのみに適用すべき指摘
   - ルール化により、同じ指摘を繰り返さない仕組みを実現
   - **ナレッジ未活用の検出:**
     - 指摘内容が既存ナレッジに含まれていた場合、ナレッジ未活用として記録
     - 未活用記録は `98_Metrics/Knowledge/unused_knowledge_[date].md` に保存
     - 未活用の原因を分析し、ナレッジ構造の改善を促す
   - **Loop Limit:** 修正ループは**最大5回**まで
   - 5回超過時は自動的にエスカレーション（上位階層へ相談チケット発行）

   **OK（承認）の場合:**
   - 成果物を承認
   - 上位階層へ統合（または `20_Approved_Outputs/` へ移動）
   - 承認記録を `96_Agents/[agent_id]/work/review_logs/` に保存

#### 4.2.2 実装要件

- レビューループのカウンターをステートに保持
- 5回超過時のエスカレーション処理を実装
- レビュー結果は必ずログに記録

### 4.3 ナレッジ共有と自己進化 (Evolution Phase)

タスク完了ステータスへの遷移時、システムは強制的に以下の処理を実行する。

#### 4.3.1 プロセスフロー

1. **Self-Update（自己更新）**
   - エージェントは自身のYAML（`96_Agents/[agent_id]/profile.md`）の `learned_lessons` に今回の教訓を追記
   - ファイルロック機構を使用して同時更新を防止
   - 追記形式: `"YYYY-MM-DD: [教訓の内容]"`
   - 教訓は具体的で再利用可能な形式で記述

2. **Knowledge Sharing（ナレッジ共有）**
   - 汎用性が高い知見（成功事例、市場トレンド等）を判定
   - **ナレッジの振り分け:**
     - **全社共有ナレッジ** (`95_Library/00_Global/`): 全エージェントが参照すべき知識
     - **部門共有ナレッジ** (`95_Library/10_Dept/[dept_id]/`): 特定部門内で共有すべき知識
     - **個人ナレッジ** (`96_Agents/[agent_id]/Library/`): エージェントが個別に収集・蓄積した知識
   - 該当する知見は適切なディレクトリに新規Markdownファイルとして体系化・保存
   - ファイル名は `[カテゴリ]_[日付]_[タイトル].md` 形式
   - YAML Frontmatterでメタデータ（作成者、関連タスク、カテゴリ、タグ等）を付与
   - **知識の検証:** 共有前にナレッジの正確性と有用性を検証
   - **ナレッジの品質管理:**
     - 既存ナレッジとの重複チェック
     - ナレッジの関連性分析
     - ナレッジの有効期限設定（必要に応じて）
   - **ナレッジの活用促進:**
     - ナレッジのアクセス統計を追跡
     - 有用なナレッジを推奨
     - 古いナレッジのアーカイブ化
   - **知識の検証:** 共有前にナレッジの正確性と有用性を検証
   - **ナレッジの活用チェック（必須）:**
     - タスク実行前に、関連ナレッジを必ず検索・参照することを強制
     - ナレッジ参照ログを記録（`96_Agents/[agent_id]/logs/knowledge_access/[date].log`）
     - 参照されなかったナレッジを検出し、原因を分析

3. **Self-Improvement（自己改善）**
   - エージェントは自身のパフォーマンスを分析し、改善点を特定
   - 改善計画を `96_Agents/[agent_id]/Performance/improvement_plan.md` に記録
   - 改善アクションを実行し、効果を測定
   - 成功した改善は他のエージェントと共有

#### 4.3.2 実装要件

- タスク完了時に必ずEvolution Phaseを実行
- `learned_lessons` の更新は自動化
- ナレッジ共有の判定ロジックを実装（汎用性スコアリング等）
- 自己改善のサイクルを自動化
- ナレッジ参照チェックを必須機能として実装
- ナレッジ未活用の検出と分析を自動化
- ナレッジ参照チェックを必須機能として実装
- ナレッジ未活用の検出と分析を自動化

### 4.3.3 自己進化メカニズム（Self-Evolution Mechanism）

#### 4.3.3.1 エージェントの自己最適化

- **能力の自己評価:**
  - エージェントは定期的に自身の能力を評価
  - 弱い領域を特定し、強化計画を策定
  - 評価結果は `96_Agents/[agent_id]/Performance/self_assessment_[date].md` に記録

- **プロンプトの自己改善:**
  - エージェントは自身のプロンプト（指示理解、実行方法等）を継続的に改善
  - 効果的なプロンプトパターンを学習し、適用
  - 改善履歴を `96_Agents/[agent_id]/Performance/prompt_evolution.md` に記録

- **ツール使用の最適化:**
  - エージェントは使用ツールの効果を分析
  - より効率的なツールの組み合わせを発見
  - ツール使用パターンの改善を `96_Agents/[agent_id]/Performance/tool_optimization.md` に記録

#### 4.3.3.2 構造的進化

- **エージェント定義の自己更新:**
  - エージェントは自身のYAML定義（`80_Team_Profiles/[agent_id].md`）を改善提案
  - 改善提案はManagerの承認を経て適用
  - 改善提案は `96_Agents/[agent_id]/Performance/evolution_proposals.md` に記録

- **組織構造の最適化提案:**
  - エージェントは組織構造の改善案を提案
  - 提案は `10_Decision_Board/` に提出され、User/Managerが判断

#### 4.3.3.3 ナレッジ構造の進化（Knowledge Structure Evolution）

- **ナレッジ未活用の原因分析:**
  - ナレッジが参照されなかった原因を分析：
    - **検索性の問題:** ナレッジが見つけにくい（タグ不足、分類不適切、ファイル名不明確等）
    - **関連性の問題:** ナレッジとタスクの関連性が低い（カテゴリ不一致、内容のミスマッチ等）
    - **アクセシビリティの問題:** ナレッジへのアクセス権限やパスの問題
    - **品質の問題:** ナレッジの内容が古い、不正確、不完全等
  - 原因分析結果は `98_Metrics/Knowledge/unused_analysis_[date].md` に記録

- **ナレッジ構造の改善:**
  - 未活用原因に基づいて、ナレッジ構造を自動的に改善：
    - **再分類:** ナレッジをより適切なカテゴリに移動
    - **タグ追加:** 検索性を向上させるタグを追加
    - **ファイル名変更:** より分かりやすいファイル名に変更
    - **関連ナレッジのリンク:** 関連するナレッジ間のリンクを追加
    - **要約の追加:** ナレッジの要約を追加し、検索時の関連性判定を向上
  - 改善履歴は `95_Library/00_Global/.evolution_log.md` に記録

- **ナレッジの統合・分割:**
  - 関連するナレッジが分散している場合、統合を検討
  - 大きなナレッジが特定部分のみ参照される場合、分割を検討
  - 統合・分割の提案は `10_Decision_Board/knowledge_restructure/` に提出

- **ナレッジの自動推奨強化:**
  - タスク開始時に、関連ナレッジを自動的に推奨
  - 推奨精度を継続的に改善（機械学習的アプローチ）
  - 推奨されなかったナレッジの原因を分析し、推奨アルゴリズムを改善

- **ナレッジ構造の進化サイクル:**
  - 週次でナレッジ未活用状況を分析
  - 月次でナレッジ構造の包括的な見直しを実施
  - 進化の効果を測定し、次のサイクルに反映

#### 4.3.3.4 実装要件

- 自己進化機能は必須機能として実装
- 進化の履歴は全て記録し、追跡可能にする
- 進化の効果は定量的に測定する
- ナレッジ構造の進化機能を必須機能として実装
- ナレッジ未活用の検出と分析を自動化
- ナレッジ構造の改善を自動化（承認フローを経て適用）

### 4.4 例外処理と人事 (Exception & HR Phase)

#### 4.4.1 エスカレーション（Escalation）

- **発生条件:**
  - 現場で解決できないルール矛盾が発生
  - レビュー修正ループが5回超過
  - 技術的制約により実現不可能と判断
- **処理:**
  - 上位階層へ「相談チケット」を発行
  - チケットは `10_Decision_Board/` に保存
  - チケットには以下を含む:
    - 問題の詳細
    - 試行した解決策
    - 必要な意思決定事項
    - 推奨される対応

#### 4.4.2 増員申請（Hiring Request）

- **発生条件:**
  - Managerがリソース不足と判断
  - かつ `current_headcount >= max_subordinates` の場合
- **処理:**
  - Userへ「増員申請」を行う
  - 申請は `10_Decision_Board/` に保存
  - 申請には以下を含む:
    - 必要なスキル・役割
    - 増員の理由（業務量、専門性の必要性等）
    - 予想されるコスト影響
- **承認後:**
  - Userの承認後、新しいエージェントを生成：
    1. `96_Agents/[agent_id]/` ディレクトリ構造を作成（work/, rules/, library/, performance/, logs/）
    2. `96_Agents/[agent_id]/profile.md` を作成（エージェント定義の実体）
    3. `80_Team_Profiles/[agent_id].md` をシンボリックリンクとして作成（96_Agents/[agent_id]/profile.mdへの参照）
    4. supervisor_idの整合性チェック（存在確認、循環参照チェック）
    5. `current_headcount` を更新

#### 4.4.3 ルール更新（Rule Update）

- **発生条件:**
  - Managerがレビューを通じて頻出する指摘事項を発見
  - 既存ルールの不備や矛盾を発見
- **処理:**
  - Managerは指摘内容を分析し、適切なルール階層に振り分けて記録
  - **ルール振り分けの判断基準:**
    - 全社ルール: 複数の部門で発生する可能性がある指摘、組織全体の方針に関わる指摘
    - 部門ルール: 特定部門の業務特性に特化した指摘
    - 複数部門共通ルール: 2つ以上の部門に共通して適用すべき指摘
    - 個人ルール: 特定エージェントのスキルや特性に特化した指摘
  - ルールファイルを直接編集・更新
  - 更新履歴をルールファイル内に記録（YAML Frontmatterに `updated_at`, `updated_by`, `related_review_log` を記録）
  - 重大な変更の場合は `10_Decision_Board/` に通知
  - **重複防止:** 既存ルールと類似の指摘がないか検索し、重複を避ける

### 4.5 パフォーマンス評価とフィードバック (Performance & Feedback Phase)

#### 4.5.1 定期的な評価サイクル

- **評価タイミング:**
  - タスク完了時: 各タスク完了後に簡易評価を実施
  - 週次レビュー: 週単位でパフォーマンスを集計
  - 月次評価: 月単位で包括的な評価を実施
- **評価指標:**
  - **品質指標:** レビュー通過率、修正回数、最終成果物の品質スコア
  - **効率指標:** タスク完了時間、リソース使用量、コスト効率
  - **協調性指標:** 他エージェントとの協力度、情報共有の積極性
  - **成長指標:** 学習履歴の蓄積、スキル向上度、ルール遵守率
- **記録:**
  - 評価結果は `96_Agents/[agent_id]/Performance/` に保存
  - YAML Frontmatterで評価日、評価者、各指標のスコアを記録

#### 4.5.2 フィードバックと改善提案

- **自動フィードバック生成:**
  - パフォーマンスデータを分析し、改善提案を自動生成
  - 弱い領域の特定と強化方法の提案
  - 成功パターンの抽出と共有
- **Managerによるフィードバック:**
  - Managerが定期的に部下エージェントにフィードバックを提供
  - フィードバックは `96_Agents/[agent_id]/Performance/feedback_[date].md` に記録
- **自己評価:**
  - エージェントが自身のパフォーマンスを振り返り、改善計画を策定

### 4.6 コミュニケーションとコラボレーション (Communication & Collaboration Phase)

#### 4.6.1 エージェント間コミュニケーション

- **会話記録:**
  - エージェント間の重要な会話は `97_Communication/Conversations/` に記録
  - 会話にはメタデータ（参加者、日時、トピック、決定事項）を付与
- **情報共有:**
  - エージェントは関連する情報を他エージェントと共有
  - 共有情報は適切なナレッジライブラリに自動的に反映
- **相談・質問:**
  - エージェントは他エージェントに相談・質問が可能
  - 相談は `97_Communication/Conversations/` に記録され、回答も追記

#### 4.6.2 依存関係管理

- **依存関係の追跡:**
  - タスク間の依存関係を `97_Communication/Dependencies/` に記録
  - 依存関係マップを自動生成・更新
- **クリティカルパス分析:**
  - プロジェクトのクリティカルパスを自動計算
  - ボトルネックの検出と警告
- **リソース競合の検出:**
  - 複数タスクが同じリソースを要求する場合の検出
  - 競合解決の提案

#### 4.6.3 意思決定の記録

- **重要意思決定の記録:**
  - 重要な意思決定は `97_Communication/Decisions/` に記録
  - 決定内容、根拠、参加者、代替案を記録
- **決定の追跡:**
  - 決定の実行状況を追跡
  - 決定の効果を後から評価可能にする

### 4.7 優先順位付けとリソース配分 (Priority & Resource Allocation Phase)

#### 4.7.1 タスク優先順位管理

- **優先順位の設定:**
  - タスクに優先度（Critical, High, Medium, Low）を付与
  - デッドラインに基づく自動優先度調整
- **優先順位の動的更新:**
  - 状況変化に応じて優先順位を自動再評価
  - Managerが優先順位を手動調整可能
- **優先順位の可視化:**
  - 優先順位マトリクスを自動生成
  - `98_Metrics/Performance/priority_matrix.md` に保存

#### 4.7.2 リソース配分の最適化

- **リソース需要の予測:**
  - 過去のデータからリソース需要を予測
  - ピーク時のリソース不足を事前に検出
- **配分の最適化:**
  - リソース配分を最適化するアルゴリズムを実装
  - 公平性と効率性のバランスを考慮

### 4.8 リスク管理と品質保証 (Risk Management & Quality Assurance Phase)

#### 4.8.1 リスクの検出と評価

- **リスクの自動検出:**
  - タスク実行中にリスク要因を自動検出
  - リスクは `98_Metrics/Risk/` に記録
- **リスク評価:**
  - リスクの影響度と発生確率を評価
  - リスクマトリクスを自動生成
- **リスク対応:**
  - リスク対応計画を自動生成
  - 重大なリスクは上位階層にエスカレーション

#### 4.8.2 品質メトリクスの追跡

- **品質指標の収集:**
  - レビュー通過率、修正回数、顧客満足度等を追跡
  - 品質メトリクスは `98_Metrics/Quality/` に記録
- **品質トレンドの分析:**
  - 品質の推移を分析し、改善傾向を検出
  - 品質低下の早期警告

### 4.9 継続的改善 (Continuous Improvement Phase)

#### 4.9.1 定期的な振り返り（レトロスペクティブ）

- **振り返りの実施:**
  - 週次・月次で振り返りを実施
  - 振り返り結果は `98_Metrics/Performance/retrospective_[date].md` に記録
- **改善アクション:**
  - 振り返りから改善アクションを抽出
  - 改善アクションの実行と追跡

#### 4.9.2 プロセス改善の提案

- **自動改善提案:**
  - データ分析からプロセス改善案を自動生成
  - 改善案は `10_Decision_Board/` に提案として提出
- **A/Bテスト的な試行:**
  - 改善案を小規模で試行し、効果を測定
  - 効果が確認されたら全社展開

### 4.10 システム健全性モニタリング (Health Monitoring Phase)

#### 4.10.1 エージェントの健康状態チェック

- **負荷監視:**
  - エージェントの負荷（タスク数、処理時間、エラー率）を監視
  - 過負荷状態を検出し、警告を発出
- **バーンアウト検出:**
  - パフォーマンス低下、エラー増加等からバーンアウトを検出
  - 検出時は休憩推奨やタスク再配分を提案

#### 4.10.2 システム全体の健全性

- **システムメトリクス:**
  - システム全体の健全性を `98_Metrics/Health/` に記録
  - 可用性、パフォーマンス、エラー率等を追跡
- **異常検出:**
  - 異常なパターンを検出し、自動的にアラートを発出
  - 重大な異常はUserに通知

### 4.11 Yesマン対策 (Anti-Yes-Man Mechanism)

#### 4.11.1 批判的思考の強制

- **必須批判プロセス:**
  - エージェントは指示を受けた際、必ず批判的検証（Critique）を実施
  - 「はい」と即答することを禁止し、必ず検証結果を報告
  - 批判的検証をスキップした場合は警告を発出

- **代替案の提示義務:**
  - 指示に問題がある場合、代替案を必ず提示
  - 代替案なしの拒否は不可（建設的な提案が必須）
   - 代替案は `96_Agents/[agent_id]/work/review_logs/alternatives/` に記録

#### 4.11.2 同意率の監視

- **同意率の追跡:**
  - エージェントの指示への同意率を追跡
  - 同意率が異常に高い（例: 95%以上）場合は警告
  - 同意率は `98_Metrics/Performance/[agent_id]_agreement_rate.md` に記録

- **批判的意見の評価:**
  - 批判的意見の質と有用性を評価
  - 建設的な批判をしたエージェントを評価
  - 評価結果はパフォーマンス指標に反映

#### 4.11.3 多様な視点の確保

- **複数エージェントによる検証:**
  - 重要な決定には複数のエージェントによる検証を実施
  - 異なる視点からの意見を収集
  - 意見の多様性を確保

- **異議申し立ての奨励:**
  - エージェントは異議を申し立てることを奨励
  - 異議申し立ては `10_Decision_Board/objections/` に記録
  - 異議が採用された場合、異議を申し立てたエージェントを評価

#### 4.11.4 実装要件

- 批判的思考プロセスは必須機能として実装
- 同意率の監視を自動化
- Yesマンパターンの検出と警告機能を実装

### 4.12 全体最適化 (Global Optimization Phase)

#### 4.12.1 個別最適 vs 全体最適のバランス

- **全体最適の優先:**
  - 個別エージェントの最適化ではなく、組織全体の最適化を優先
  - 個別最適が全体最適を損なう場合は調整
  - 全体最適の判断はGeneral CommanderまたはUserが実施

- **リソース配分の全体最適化:**
  - リソース（タスク、時間、コスト）を組織全体で最適化
  - 部門間のリソース配分を動的に調整
  - 最適化結果は `98_Metrics/Performance/global_optimization_[date].md` に記録

#### 4.12.2 組織全体の目標設定

- **組織目標の明確化:**
  - 組織全体の目標を明確に定義
  - 個別エージェントの目標が組織目標と整合しているか確認
  - 目標は `00_Strategy_Input/organizational_goals.md` に記録

- **目標達成の追跡:**
  - 組織目標の達成状況を追跡
  - 目標達成に貢献するエージェントを評価
  - 目標未達成の原因を分析し、改善策を策定

#### 4.12.3 部門間の協調

- **部門間の情報共有:**
  - 部門間で情報を共有し、全体最適を実現
  - 部門間の協調度を測定
  - 協調度は `98_Metrics/Performance/collaboration_score.md` に記録

- **部門間の競合解決:**
  - 部門間でリソース競合が発生した場合、全体最適の観点から解決
  - 競合解決の記録は `97_Communication/Dependencies/conflict_resolution.md` に保存

#### 4.12.4 全体最適化アルゴリズム

- **最適化指標:**
  - 組織全体の効率性、品質、コスト、満足度を総合的に評価
  - 複数の指標をバランスよく最適化
  - 最適化指標は `98_Metrics/Performance/global_metrics.md` に記録

- **最適化サイクル:**
  - 定期的（週次・月次）に全体最適化を実施
  - 最適化結果を分析し、次のサイクルに反映
  - 最適化履歴は `98_Metrics/Performance/optimization_history.md` に記録

#### 4.12.5 実装要件

- 全体最適化機能を必須機能として実装
- 個別最適と全体最適のバランスを自動調整
- 最適化の効果を定量的に測定

---

## 5. ガバナンス・非機能要件

### 5.1 セキュリティ (Security)

#### 5.1.1 機密情報の隔離

- **要件:**
  - APIキー、パスワード、ログイン情報は Obsidian 内（Markdown）には一切記述しない
  - 全てローカル環境の `.env` ファイルで管理
  - Pythonコード経由でのみアクセスする
- **実装:**
  - `.env` ファイルを `.gitignore` に追加
  - 環境変数の読み込みは `python-dotenv` を使用
  - Markdownファイル内に機密情報が含まれていないか、定期的に検証

#### 5.1.2 外部アクション制限

- **要件:**
  - SNS投稿、メール送信、Webフォーム送信などの対外的アクションは、原則として「下書き作成」または「テスト送信」までとする
  - 本番実行（Commit）には User の明示的な承認アクションを必須とする
- **実装:**
  - 外部アクション用のツールは「Dry-runモード」をデフォルトとする
  - 本番実行は `10_Decision_Board/` に承認リクエストを発行
  - Userが承認した場合のみ実行

### 5.2 コスト・リソース管理 (Resource Management)

#### 5.2.1 Token Optimization

- **要件:**
  - 各エージェントに渡すコンテキスト（過去ログ）は、関連性の高いものだけに制限
  - RAG的アプローチでトークン消費を抑制
- **実装:**
  - 過去ログの検索機能を実装（セマンティック検索）
  - 関連性スコアに基づいて上位N件のみをコンテキストに含める
  - トークン使用量を `99_Logs/cost_tracking.log` に記録

#### 5.2.2 Execution Limit

- **要件:**
  - 承認プロセスのリトライ回数上限（5回）をハードコードで設定
  - 無限ループによる課金を防止
- **実装:**
  - LangGraphのステートに `review_loop_count` を保持
  - 5回超過時は自動的にエスカレーション
  - ループ検出ロジックを実装

#### 5.2.3 コスト追跡

- **要件:**
  - API呼び出しのコストを追跡
  - 日次・月次のコストレポートを生成
- **実装:**
  - 各API呼び出し後にトークン数とコストを記録
  - `99_Logs/cost_tracking.log` にCSV形式で保存
  - 定期的にレポートを生成（`99_Logs/cost_report_[date].md`）

### 5.3 拡張性 (Scalability)

#### 5.3.1 エージェントの動的生成

- **要件:**
  - 各エージェントは共通のPythonクラス（`AgentNode`）のインスタンスとして生成
  - YAMLファイルの追加のみで組織をスケール可能とする
- **実装:**
  - `AgentNode` クラスを実装
  - `80_Team_Profiles/` 内のYAMLファイルをスキャンしてエージェントを動的に生成
  - LangGraphのノードを動的に構築

#### 5.3.2 ルールの階層管理

- **要件:**
  - 全社ルール、部門ルール、複数部門共通ルール、個人ルールを階層的に管理
  - 新しい部門やルールカテゴリを容易に追加可能
  - エージェントごとに個別のルール領域を提供
- **実装:**
  - `90_Rules/` 内で階層別にディレクトリを分割（00_Global, 10_Dept, 20_Cross_Dept）
  - `96_Agents/[agent_id]/Rules/` で個人ルールを管理
  - ルールの継承メカニズムを実装（全社ルール → 部門ルール → 個人ルール）
  - エージェントは自身が適用される全階層のルールを自動的に読み込む

#### 5.3.3 ルール振り分け機能（Rule Routing）

- **要件:**
  - レビュー時の指摘を適切なルール階層に自動振り分け
  - 同じ指摘の重複を防止
  - 指摘の適用範囲を明確化
- **実装:**
  - Managerがレビュー時に指摘を分類する機能を実装
  - 指摘内容を分析し、適用範囲を判定：
    - 全社適用: 複数部門で発生する可能性がある指摘
    - 部門適用: 特定部門の業務特性に特化した指摘
    - 複数部門共通: 2つ以上の部門に共通する指摘
    - 個人適用: 特定エージェントのスキルや特性に特化した指摘
  - 既存ルールとの類似度検索機能を実装（重複防止）
  - ルールファイルに `related_review_log` を記録し、指摘の出所を追跡可能にする

### 5.4 データ整合性とエラーハンドリング (Data Integrity & Error Handling)

#### 5.4.1 エージェント定義の整合性管理

- **要件:**
  - `80_Team_Profiles/[agent_id].md` と `96_Agents/[agent_id]/profile.md` の関係を明確化
  - データの二重管理を防止
- **実装:**
  - `96_Agents/[agent_id]/profile.md` を実体とする
  - `80_Team_Profiles/[agent_id].md` はシンボリックリンクとして自動生成
  - エージェント生成時に自動的にシンボリックリンクを作成
  - 整合性チェック機能を実装（定期的に検証）

#### 5.4.2 supervisor_idの整合性チェック

- **要件:**
  - supervisor_idが存在しないエージェントを参照する場合の処理
  - 循環的なsupervisor_idチェーン（A→B→A）の検証
- **実装:**
  - エージェント生成時にsupervisor_idの存在確認
  - 循環参照の検出アルゴリズムを実装
  - 整合性エラー時の自動修正またはエラー報告
  - 定期的な整合性チェック機能

#### 5.4.3 ファイルロック機構

- **要件:**
  - 複数エージェントが同じファイルを同時に更新する場合の競合防止
  - データの上書きを防止
- **実装:**
  - ファイルロック機構を実装（楽観的ロックまたは悲観的ロック）
  - 更新時のバージョンチェック
  - 競合検出時のリトライまたはエラー報告
  - 更新キューイングシステム（必要に応じて）

#### 5.4.4 エージェント削除プロセス

- **要件:**
  - エージェント削除時のデータクリーンアップ
  - 依存関係の処理
- **実装:**
  - 削除前の依存関係チェック（supervisor_id、タスク、参照等）
  - 削除プロセスの明確化：
    1. 依存関係の確認と警告
    2. データのアーカイブ（`20_Approved_Outputs/archived_agents/[agent_id]/`）
    3. シンボリックリンクの削除
    4. ディレクトリの削除またはアーカイブ
  - 完全削除 vs アーカイブの選択機能

#### 5.4.5 ルール・ナレッジの循環参照検出

- **要件:**
  - ルールやナレッジの循環参照を検出
  - 無限ループの防止
- **実装:**
  - 循環参照の検出アルゴリズム（深さ優先探索等）
  - 参照の深さ制限
  - 循環参照の警告とエラー報告
  - 検索時の訪問済みノード記録

#### 5.4.6 エラーハンドリングと回復機構

- **要件:**
  - ファイル読み込みエラー、API呼び出し失敗、ディスク容量不足等の処理
  - システムの安定性確保
- **実装:**
  - 各エラーケースの処理を明確に定義
  - フォールバック機構（デフォルト値、代替処理等）
  - エラーログと通知機能
  - 自動回復機能（可能な場合）
  - ディスク容量監視と自動クリーンアップ

#### 5.4.7 トランザクション機構

- **要件:**
  - 複数ファイル更新の原子性
  - 部分的な更新による不整合の防止
- **実装:**
  - トランザクション機構の実装（可能な範囲で）
  - ロールバック機能
  - 整合性チェック機能
  - エージェント生成時の原子性保証

### 5.5 パフォーマンス最適化 (Performance Optimization)

#### 5.5.1 ナレッジ検索の最適化

- **要件:**
  - 大量のナレッジがある場合の検索効率向上
  - APIコストの抑制
- **実装:**
  - インデックス機構の実装（セマンティックインデックス、キーワードインデックス）
  - 検索結果のキャッシュ
  - 段階的検索（個人→部門→全社の順で検索）
  - 検索結果の上限設定

#### 5.5.2 エージェント読み込みの最適化

- **要件:**
  - 大量のエージェントがある場合の起動時間短縮
  - メモリ使用量の抑制
- **実装:**
  - 遅延読み込み（必要なエージェントのみ読み込む）
  - エージェントメタデータのインデックス
  - ルール・ナレッジの遅延読み込み
  - キャッシュ機構

#### 5.5.3 ディスク容量管理

- **要件:**
  - ディスク容量の監視と管理
  - 自動クリーンアップ
- **実装:**
  - ディスク容量監視機能
  - 自動クリーンアップ機構（古いログ、一時ファイル等）
  - ログローテーション
  - 古いデータのアーカイブ機能

---

## 6. 実装チェックリスト

### 6.1 ディレクトリ構造
- [ ] `AI_Manager_Root` ディレクトリと全サブディレクトリを作成
- [ ] システム全体の共有ディレクトリ（00_Strategy_Input, 10_Decision_Board等）を作成
- [ ] 30_Work_Spaceを簡素化（一時ファイルのみ、temp/サブディレクトリ）
- [ ] ルール階層ディレクトリ（90_Rules/00_Global, 10_Dept, 20_Cross_Dept）を作成
- [ ] ナレッジ階層ディレクトリ（95_Library/00_Global, 10_Dept）を作成
- [ ] エージェント個別領域ディレクトリ（96_Agents/[agent_id]/）の動的生成機能を実装
- [ ] エージェント統合構成の実装：
  - [ ] `96_Agents/[agent_id]/profile.md` の作成（80_Team_Profilesとの連携）
  - [ ] `96_Agents/[agent_id]/work/` の作成（drafts/, review_logs/）
  - [ ] `96_Agents/[agent_id]/rules/` の作成
  - [ ] `96_Agents/[agent_id]/library/` の作成
  - [ ] `96_Agents/[agent_id]/performance/` の作成
  - [ ] `96_Agents/[agent_id]/logs/knowledge_access/` の作成
- [ ] 80_Team_Profiles/[agent_id].md と 96_Agents/[agent_id]/profile.md の連携（シンボリックリンクまたは参照）

### 6.2 エージェントシステム
- [ ] `AgentNode` クラスを実装
- [ ] YAML Frontmatterパーサーを実装
- [ ] エージェントの動的生成機能を実装
- [ ] 階層構造（supervisor_id）の管理機能を実装
- [ ] Foundation Model選択機能を実装（各エージェントごとに異なるAIモデルを使用可能）
- [ ] 複数APIプロバイダー（Anthropic, OpenAI, Google等）の統合

### 6.3 LangGraph実装
- [ ] ステートマシンの定義
- [ ] Planning & Critique Phaseの実装
- [ ] Execution & Review Phaseの実装
- [ ] Evolution Phaseの実装
- [ ] Exception & HR Phaseの実装
- [ ] ループカウンターの実装（最大5回）

### 6.4 ツール統合
- [ ] Browser-use統合
- [ ] Zapier統合
- [ ] Local File System操作
- [ ] Obsidianファイル操作

### 6.5 セキュリティ
- [ ] `.env` ファイル管理
- [ ] 機密情報の検証機能
- [ ] 外部アクションのDry-runモード
- [ ] 承認フローの実装

### 6.6 コスト管理
- [ ] トークン使用量の追跡
- [ ] コストログの記録
- [ ] RAG的コンテキスト最適化
- [ ] コストレポート生成

### 6.7 ナレッジ管理
- [ ] `learned_lessons` の自動更新
- [ ] `95_Library/` へのナレッジ保存機能
- [ ] ナレッジ検索機能（セマンティック検索）
- [ ] ナレッジの正確性検証機能
- [ ] ナレッジの有用性評価機能
- [ ] ナレッジの自動分類・タグ付け機能
- [ ] ナレッジの関連性分析機能
- [ ] ナレッジの重複検出・統合機能
- [ ] ナレッジの有効期限管理機能
- [ ] ナレッジのアクセス統計・利用状況追跡
- [ ] ナレッジの階層管理（全社、部門、個人）
- [ ] ナレッジ振り分け機能（全社/部門/個人の判定）
- [ ] エージェントごとの個人ナレッジ領域管理（96_Agents/[agent_id]/Library/）
- [ ] ナレッジ参照チェック機能（タスク実行前の必須参照）
- [ ] ナレッジ参照ログ記録機能
- [ ] ナレッジ未活用の検出機能
- [ ] レビュー時のナレッジ参照チェック機能（既存ナレッジに含まれていたらNG）
- [ ] ナレッジ未活用の原因分析機能
- [ ] ナレッジ構造の自動改善機能（再分類、タグ追加、ファイル名変更等）
- [ ] ナレッジの統合・分割提案機能
- [ ] ナレッジ自動推奨機能の強化
- [ ] ナレッジ構造進化サイクルの実装（週次分析、月次見直し）

### 6.8 ルール管理
- [ ] ルールファイルの読み込み機能（階層的読み込み）
- [ ] ルールの階層管理（全社、部門、複数部門共通、個人）
- [ ] ルール更新機能
- [ ] ルール振り分け機能（Rule Routing）の実装
- [ ] 既存ルールとの類似度検索機能（重複防止）
- [ ] エージェントごとの個人ルール領域管理（96_Agents/[agent_id]/Rules/）
- [ ] ルールの適用範囲判定ロジック

### 6.10 パフォーマンス評価システム
- [ ] パフォーマンス指標の自動収集（品質、効率、協調性）
- [ ] 評価サイクルの実装（タスク完了時、週次、月次）
- [ ] フィードバック自動生成機能
- [ ] パフォーマンス記録の保存（96_Agents/[agent_id]/Performance/）
- [ ] 改善提案の自動生成

### 6.11 コミュニケーション・コラボレーション
- [ ] エージェント間会話記録機能（97_Communication/Conversations/）
- [ ] 意思決定記録機能（97_Communication/Decisions/）
- [ ] 依存関係マップの自動生成（97_Communication/Dependencies/）
- [ ] クリティカルパス分析機能
- [ ] リソース競合検出機能

### 6.12 優先順位付け・リソース配分
- [ ] タスク優先順位管理機能
- [ ] 優先順位の動的更新機能
- [ ] リソース需要予測機能
- [ ] リソース配分最適化アルゴリズム

### 6.13 リスク管理・品質保証
- [ ] リスク自動検出機能
- [ ] リスク評価・マトリクス生成
- [ ] 品質メトリクス収集機能
- [ ] 品質トレンド分析機能
- [ ] 異常検出・アラート機能

### 6.14 継続的改善
- [ ] レトロスペクティブ機能（週次・月次）
- [ ] プロセス改善提案の自動生成
- [ ] A/Bテスト的試行機能
- [ ] 改善効果の測定・評価

### 6.15 システム健全性モニタリング
- [ ] エージェント負荷監視機能
- [ ] バーンアウト検出機能
- [ ] システム全体の健全性チェック
- [ ] 異常パターン検出・アラート機能
- [ ] メトリクスダッシュボード生成

### 6.16 自己改善・自己進化
- [ ] 自己評価機能（能力、パフォーマンス）
- [ ] 改善計画の自動生成
- [ ] プロンプトの自己改善機能
- [ ] ツール使用の最適化機能
- [ ] エージェント定義の自己更新提案機能
- [ ] 組織構造最適化提案機能
- [ ] 進化履歴の記録・追跡機能

### 6.17 Yesマン対策
- [ ] 批判的思考プロセスの強制実装
- [ ] 代替案提示の義務化
- [ ] 同意率の監視・追跡機能
- [ ] 批判的意見の評価機能
- [ ] 多様な視点の確保機能（複数エージェント検証）
- [ ] 異議申し立ての奨励・記録機能
- [ ] Yesマンパターンの検出・警告機能

### 6.18 全体最適化
- [ ] 個別最適 vs 全体最適のバランス調整機能
- [ ] リソース配分の全体最適化アルゴリズム
- [ ] 組織目標の明確化・追跡機能
- [ ] 部門間協調度の測定機能
- [ ] 部門間競合解決機能
- [ ] 全体最適化指標の定義・測定
- [ ] 最適化サイクルの実装（週次・月次）

### 6.19 データ整合性とエラーハンドリング
- [ ] エージェント定義の整合性管理（80_Team_Profilesと96_Agentsの関係）
- [ ] シンボリックリンクの自動生成・管理
- [ ] supervisor_idの整合性チェック機能
- [ ] 循環参照の検出機能
- [ ] ファイルロック機構の実装
- [ ] エージェント削除プロセスの実装
- [ ] 依存関係チェック機能
- [ ] ルール・ナレッジの循環参照検出機能
- [ ] エラーハンドリング機能（ファイル読み込み、API呼び出し等）
- [ ] フォールバック機構
- [ ] トランザクション機構（複数ファイル更新の原子性）
- [ ] ディスク容量監視機能

### 6.20 パフォーマンス最適化
- [ ] ナレッジ検索のインデックス機構
- [ ] 検索結果のキャッシュ機能
- [ ] エージェントの遅延読み込み機能
- [ ] ルール・ナレッジの遅延読み込み機能
- [ ] エージェントメタデータのインデックス
- [ ] 自動クリーンアップ機構（ログ、一時ファイル等）
- [ ] ログローテーション機能
- [ ] 古いデータのアーカイブ機能

---

## 7. 用語集

| 用語 | 説明 |
|------|------|
| **AgentNode** | エージェントを表現するPythonクラス。LangGraphのノードとして機能 |
| **Bottom-up Critique** | 下位階層のエージェントが上位の指示に対して批判的検証を行う機能 |
| **Gatekeeper** | Managerが成果物を承認する役割。品質管理の要 |
| **Dry-runモード** | 実際には実行せず、実行内容をシミュレーションするモード |
| **RAG** | Retrieval-Augmented Generation。関連情報を検索してコンテキストに含める手法 |
| **YAML Frontmatter** | Markdownファイルの先頭に記述されるYAML形式のメタデータ |
| **Rule Routing** | レビュー時の指摘を適切なルール階層（全社/部門/個人）に振り分ける機能 |
| **Performance Metrics** | エージェントのパフォーマンスを定量化する指標（品質、効率、協調性等） |
| **Critical Path** | プロジェクト完了に必要な最長経路。遅延が全体の遅延に直結する |
| **Retrospective** | 定期的な振り返り。過去の活動を評価し、改善点を特定するプロセス |
| **Health Monitoring** | システム全体および個別エージェントの健全性を監視する機能 |
| **Self-Evolution** | エージェントが自身の能力、プロンプト、ツール使用を継続的に改善する機能 |
| **Self-Improvement** | エージェントが自身のパフォーマンスを分析し、改善計画を策定・実行する機能 |
| **Yes-Man Syndrome** | エージェントが常に「はい」と同意し、批判的思考をしない問題 |
| **Anti-Yes-Man Mechanism** | Yesマン問題を防ぐための批判的思考強制、同意率監視等の仕組み |
| **Global Optimization** | 個別エージェントの最適化ではなく、組織全体の最適化を目指す機能 |
| **Local Optimization** | 個別エージェントや部門の最適化。全体最適と対比される概念 |
| **Knowledge Structure Evolution** | ナレッジが使われるように構造を継続的に改善・進化させる機能 |
| **Unused Knowledge Detection** | ナレッジが参照されなかった場合の検出機能。原因分析と構造改善を促す |
| **Knowledge Reference Check** | タスク実行前やレビュー時に、関連ナレッジを参照したかをチェックする機能 |

---

## 8. Foundation Model設定仕様

### 8.1 対応プロバイダー

システムは以下のAI APIプロバイダーに対応する：

| プロバイダー | 環境変数名 | 対応モデル例 |
|------------|----------|------------|
| **Anthropic** | `ANTHROPIC_API_KEY` | claude-4-5-sonnet, claude-3-5-sonnet, claude-3-7-sonnet |
| **OpenAI** | `OPENAI_API_KEY` | gpt-4, gpt-4-turbo, gpt-3.5-turbo |
| **Google** | `GOOGLE_API_KEY` | gemini-pro, gemini-ultra |
| **その他** | カスタム | カスタムAPIエンドポイントに対応 |

### 8.2 モデル選択の原則

- **デフォルト:** Claude 4.5 Sonnet（ベースモデル）
- **個別設定:** 各エージェントのYAMLで `foundation_model` を指定
- **コスト最適化:** タスクの重要度や複雑度に応じてモデルを選択可能
- **フォールバック:** 指定モデルが利用不可の場合、デフォルトモデルに自動切り替え

### 8.3 実装要件

- 各エージェントは独立したAIモデルインスタンスを持つ
- APIキーは `.env` ファイルから環境変数経由で読み込み
- モデル切り替えはランタイムで動的に実行可能
- コスト追跡はモデルごとに個別に記録

---

## 9. 参考資料

- LangGraph公式ドキュメント: https://langchain-ai.github.io/langgraph/
- Anthropic API ドキュメント: https://docs.anthropic.com/
- OpenAI API ドキュメント: https://platform.openai.com/docs/
- Google AI API ドキュメント: https://ai.google.dev/docs
- Obsidian公式サイト: https://obsidian.md/
- YAML Frontmatter仕様: https://jekyllrb.com/docs/front-matter/

---

**ドキュメントバージョン:** 1.3  
**最終更新日:** 2025-12-26  
**作成者:** A.K.A.T.S.U.K.I. プロジェクトチーム

---

## 変更履歴

### v1.3 (2025-12-26)
- データ整合性とエラーハンドリングの強化
  - エージェント定義の整合性管理（80_Team_Profilesと96_Agentsの関係明確化）
  - supervisor_idの整合性チェックと循環参照検出
  - ファイルロック機構の追加
  - エージェント削除プロセスの明確化
  - ルール・ナレッジの循環参照検出
  - エラーハンドリングとフォールバック機構
  - トランザクション機構の追加
- パフォーマンス最適化機能の追加
  - ナレッジ検索のインデックス機構
  - 遅延読み込み機能
  - ディスク容量管理と自動クリーンアップ

### v1.2 (2025-12-26)
- ディレクトリ構造の改善（エージェント中心の統合構成）
  - 30_Work_Spaceを簡素化（一時ファイルのみ）
  - 96_Agents/[agent_id]/配下にエージェント関連データを統合（work/, rules/, library/, performance/, logs/）
  - エージェント情報の一貫性とアクセス効率を向上
  - データ分散の問題を解決

### v1.1 (2025-12-26)
- エージェント個別領域（96_Agents/）の追加
- ルール階層管理（全社/部門/複数部門共通/個人）の実装
- ルール振り分け機能（Rule Routing）の追加
- パフォーマンス評価システムの追加
- コミュニケーション・コラボレーション機能の追加
- 優先順位付け・リソース配分機能の追加
- リスク管理・品質保証機能の追加
- 継続的改善機能の追加
- システム健全性モニタリング機能の追加
- 自己改善・自己進化機能の追加
- Yesマン対策（Anti-Yes-Man Mechanism）の追加
- 全体最適化機能の追加
- ナレッジ構造の進化機能の追加
- ナレッジ参照チェック機能の追加（必須化）
- Foundation Modelの柔軟な選択機能の追加

### v1.0 (2025-01-XX)
- 初版リリース

